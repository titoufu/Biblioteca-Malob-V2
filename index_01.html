<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Livros por Armário</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { color: #2c3e50; }
    ul { list-style-type: none; padding: 0; }
    li { margin: 5px 0; cursor: pointer; color: #0077cc; }
    li:hover { text-decoration: underline; }
    #livros { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Contagem de Livros por Armário</h1>
  <div id="resultado">Carregando...</div>
  <div id="livros"></div>

  <script>
    let dadosLivros = [];

    async function carregarJSON() {
      try {
      const response = await fetch('https://raw.githubusercontent.com/titoufu/Biblioteca-Malob-V2/main/livros_corrigidos.json');
dadosLivros = await response.json(); // ✅ Agora é JSON mesmo!

        mostrarContagem();
      } catch (erro) {
        document.getElementById('resultado').innerText = 'Erro ao carregar JSON: ' + erro.message;
      }
    }

    function mostrarContagem() {
      const contagem = {};

      dadosLivros.forEach(livro => {
        const armario = (livro.ARMARIO || '').trim();
        if (armario) {
          contagem[armario] = (contagem[armario] || 0) + 1;
        }
      });

      const container = document.getElementById('resultado');
      container.innerHTML = '';

      const ul = document.createElement('ul');
      Object.entries(contagem).forEach(([armario, qtd]) => {
        const li = document.createElement('li');
        li.textContent = `Armário ${armario}: ${qtd} livros`;
        li.onclick = () => mostrarLivrosDoArmario(armario);
        ul.appendChild(li);
      });

      container.appendChild(ul);
    }

    function mostrarLivrosDoArmario(armarioSelecionado) {
      const container = document.getElementById('livros');
      container.innerHTML = `<h2>Livros do Armário ${armarioSelecionado}</h2>`;

      const livros = dadosLivros.filter(l => (l.ARMARIO || '').trim() === armarioSelecionado);

      if (livros.length === 0) {
        container.innerHTML += '<p>Nenhum livro encontrado.</p>';
        return;
      }

      const ul = document.createElement('ul');
      livros.forEach(livro => {
        const li = document.createElement('li');
        li.textContent = livro.TITULO;
        ul.appendChild(li);
      });

      container.appendChild(ul);
    }

    carregarJSON();
  </script>
</body>
</html>
